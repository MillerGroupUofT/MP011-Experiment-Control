
% Build command line interface for direct device communication
function [] = BuildCLIPanel(hObject, event, figName)

    % Load handles from base workspace
    handles = evalin('base','handles');

    % Text (Available devices)
    handles.figGUI_menuTools_menuCLI_fig_text1 = uicontrol(...
        'Parent', hObject, ...
        'Style', 'text', ...
        'FontName', handles.gui_textFontName, ...       
        'String', 'Available devices:', ...
        'BackgroundColor', handles.gui_panelBackgroundColor, ...        
        'Units', 'pixels', ...
        'Position', [10 155 105 15], ...
        'HorizontalAlignment', 'left'...
        );
    
    % Pop-up menu for connected device selection
    handles.figGUI_menuTools_menuCLI_fig_devPopup = uicontrol(...
        'Parent', hObject, ...
        'Style', 'popup', ...
        'FontName', handles.gui_textFontName, ...
        'BackgroundColor', handles.gui_panelBackgroundColor, ...
        'String', handles.com_devStateList, ...
        'Position', [115 160 145 15], ...
        'HorizontalAlignment', 'center', ...
        'Callback', {@CallbackFunc_Pressbutton, {'CLI', 'select device'}, []}...    
        );
    
%             'Callback', {@CallbackFunc_CLI, 'select device'}...    

    % Text (command to server)
    handles.figGUI_menuTools_menuCLI_fig_text2 = uicontrol(...
        'Parent', hObject, ...
        'Style', 'text', ...
        'FontName', handles.gui_textFontName, ...       
        'String', 'Command for device server:', ...
        'BackgroundColor', handles.gui_panelBackgroundColor, ...        
        'Units', 'pixels', ...
        'Position', [10 130 170 15], ...
        'HorizontalAlignment', 'left'...
        );

    % Text (reply from server)
    handles.figGUI_menuTools_menuCLI_fig_text3 = uicontrol(...
        'Parent', hObject, ...
        'Style', 'text', ...
        'FontName', handles.gui_textFontName, ...       
        'String', 'Reply from server', ...
        'BackgroundColor', handles.gui_panelBackgroundColor, ...        
        'Units', 'pixels', ...
        'Position', [10 100 150 15], ...
        'HorizontalAlignment', 'left'...
        );

    % Edit box for reply from server
    handles.figGUI_menuShutters_menuCLI_fig_reply = uicontrol(...
        'Parent', hObject, ...
        'Style', 'edit', ...
        'String', '', ...
        'FontName', handles.gui_editFontName, ...
        'BackgroundColor', handles.gui_panelBackgroundColor, ...
        'ForegroundColor', handles.gui_editFontColor, ...
        'Units', 'pixels', ...
        'Position', [20 10 240 90], ...
        'Max', [2], ...
        'Min', [0], ...
        'HorizontalAlignment', 'left', ...
        'Callback', {@CallbackFunc_Pressbutton, {'CLI', 'get reply'}, []}...
    );

%         'Callback', {@CallbackFunc_CLI, 'get reply'}... 

    % Edit box for command to server
    handles.figGUI_menuShutters_menuCLI_fig_cmd = uicontrol(...
        'Parent', hObject, ...
        'Style', 'edit', ...
        'String', '', ...
        'FontName', handles.gui_editFontName, ...
        'BackgroundColor', handles.gui_panelBackgroundColor, ...
        'ForegroundColor', handles.gui_editFontColor, ...
        'Units', 'pixels', ...
        'Position', [20 115 240 15], ...
        'HorizontalAlignment', 'left', ...
        'Callback', {@CallbackFunc_Pressbutton, {'CLI', 'send command'}, handles.figGUI_menuShutters_menuCLI_fig_reply}...
    );

%         'Callback', {@CallbackFunc_CLI, 'send command', handles.figGUI_menuShutters_menuCLI_fig_reply}... 

    % Get names of devices with active server connections
    j = 1;
    for(i = 1:3)
    	if(handles.com_devState_shutters{i} > 0)
    		j = j + 1;
    		handles.com_devStateList{j} = sprintf('Shutter %d', i);
    	end
    end
    if(handles.com_devState_camera > 0)
    	j = j + 1;
    	handles.com_devStateList{j} = 'Camera';
    end
    for(i = 1:5)
        if(handles.com_devState_stages{i} > 0)
    	   j = j + 1;
    	   handles.com_devStateList{j} = sprintf('%s Stage', handles.stages_name{i});
        end
    end
    set(handles.figGUI_menuTools_menuCLI_fig_devPopup, 'String', handles.com_devStateList);

    % Save handles in base workspace
    assignin('base','handles',handles)
    
end

