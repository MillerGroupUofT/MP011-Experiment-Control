

% Build menu bar for main GUI window
function BuildMenuItems()

    % Load handles from base workspace
    handles = evalin('base','handles');

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

   % Menu item for file open, save, quit
    handles.figGUI_menuFile = uimenu(...
        'Parent', handles.figGUI, ...
        'Label', 'File'...
        );

    handles.figGUI_menuFile_menuLoad = uimenu(...
        'Parent', handles.figGUI_menuFile, ...
        'Accelerator', 'L', ...
        'Label', 'Load settings'...
        );

    handles.figGUI_menuFile_menuSave = uimenu(...
        'Parent', handles.figGUI_menuFile, ...
        'Accelerator', 'S', ...
        'Label', 'Save settings'...
        );

    handles.figGUI_menuFile_menuQuit = uimenu(...
        'Parent', handles.figGUI_menuFile, ...
        'Separator', 'on', ...
        'Accelerator', 'Q', ...
        'Label', 'Quit', ...
        'Callback', {@CallbackFunc_Close, 'main GUI'}...
        );

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    % Menu item for tools
    handles.figGUI_menuTools = uimenu(...
        'Parent', handles.figGUI, ...
        'Label', 'Tools'...
        );

    % Submenu item for color scheme
    handles.figGUI_menuTools_menuColor = uimenu(...
        'Parent', handles.figGUI_menuTools, ...
        'Label', 'GUI Colour Scheme'...
        );

    % Submenu item for color scheme (day mode)
    handles.figGUI_menuTools_menuColor_DayMode = uimenu(...
        'Parent', handles.figGUI_menuTools_menuColor, ...
        'Label', 'Day Mode'...
        );

    % Submenu item for color scheme (night mode)
    handles.figGUI_menuTools_menuColor_DayMode = uimenu(...
        'Parent', handles.figGUI_menuTools_menuColor, ...
        'Label', 'Night Mode'...
        );

    % Submenu item for timer control
    handles.figGUI_menuTools_menuTimer = uimenu(...
        'Parent', handles.figGUI_menuTools, ...
        'Label', 'Control timer...'...
        );

    % Submenu item to start timer
    handles.figGUI_menuTools_menuTimer_menuStart = uimenu(...
        'Parent', handles.figGUI_menuTools_menuTimer, ...
        'Label', 'Start', ...
        'Callback', {@ControlTimer, 'start'}...
        );

    % Submenu item to stop timer
    handles.figGUI_menuTools_menuTimer_menuStop = uimenu(...
        'Parent', handles.figGUI_menuTools_menuTimer, ...
        'Label', 'Stop', ...
        'Callback', {@ControlTimer, 'stop'}...
        );

    % Submenu item for command line interface
    handles.figGUI_menuTools_menuCLI = uimenu(...
        'Parent', handles.figGUI_menuTools, ...
        'Label', 'CLI for Server COM', ...
        'Callback', {@BuildFigureWindows, 'cli'}...
        );

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 
    % Menu item for oscilloscope settings
    handles.figGUI_menuOscilloscope = uimenu(...
        'Parent', handles.figGUI, ...
        'Label', 'Oscilloscope'...
        );

    % Menu item for oscilloscope status
    handles.figGUI_menuOscilloscope_menuConnect = uimenu(...
        'Parent', handles.figGUI_menuOscilloscope, ...
        'Label', 'Connect', ...
        'Callback', {@CallbackFunc_Pressbutton, {'Oscilloscope', 'connect oscilloscope'}, []}...
        );
    
    % Menu item for oscilloscope status
    handles.figGUI_menuOscilloscope_menuStatus = uimenu(...
        'Parent', handles.figGUI_menuOscilloscope, ...
        'Label', 'Measurement', ...
        'Enable', 'off', ...
        'Callback', {@BuildFigureWindows, 'oscilloscope measurement'}...
        );
    
    % Menu item for oscilloscope status
    handles.figGUI_menuOscilloscope_menuDisconnect = uimenu(...
        'Parent', handles.figGUI_menuOscilloscope, ...
        'Label', 'Disconnect', ...
        'Enable', 'off', ...
        'Callback', {@CallbackFunc_Pressbutton, {'Oscilloscope', 'disconnect oscilloscope'}, []}...
        );


    % Menu item for oscilloscope COM settings
    handles.figGUI_menuOscilloscope_menuCOM = uimenu(...
        'Parent', handles.figGUI_menuOscilloscope, ...
        'Label', 'IP Settings', ...
        'Separator', 'on', ...
        'Callback', {@BuildFigureWindows, 'oscilloscope com'}...
        );

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 
    % Menu item for micra settings
    handles.figGUI_menuMicra = uimenu(...
        'Parent', handles.figGUI, ...
        'Label', 'Micra'...
        );

    % Menu item for micra status
    handles.figGUI_menuMicra_menuConnect = uimenu(...
        'Parent', handles.figGUI_menuMicra, ...
        'Label', 'Connect', ...
        'Callback', {@CallbackFunc_Pressbutton, {'Micra', 'connect micra'}, []}...
        );
    
    % Menu item for micra status
    handles.figGUI_menuMicra_menuStatus = uimenu(...
        'Parent', handles.figGUI_menuMicra, ...
        'Label', 'Status', ...
        'Enable', 'off', ...
        'Callback', {@BuildFigureWindows, 'micra status'}...
        );
    
    % Menu item for micra status
    handles.figGUI_menuMicra_menuDisconnect = uimenu(...
        'Parent', handles.figGUI_menuMicra, ...
        'Label', 'Disconnect', ...
        'Enable', 'off', ...
        'Callback', {@CallbackFunc_Pressbutton, {'Micra', 'disconnect micra'}, []}...
        );


    % Menu item for micra COM settings
    handles.figGUI_menuMicra_menuCOM = uimenu(...
        'Parent', handles.figGUI_menuMicra, ...
        'Label', 'COM Settings', ...
        'Separator', 'on', ...
        'Callback', {@BuildFigureWindows, 'micra com'}...
        );

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    % Menu item for HV settings
    handles.figGUI_menuHV = uimenu(...
        'Parent', handles.figGUI, ...
        'Label', 'HV'...
        );
    
    % Menu item for HV connect
    handles.figGUI_menuHV_menuConnect = uimenu(...
        'Parent', handles.figGUI_menuHV, ...
        'Label', 'Connect', ...
        'Callback', {@CallbackFunc_Pressbutton, {'HV', 'connect HV'}, []}...
        );


    % Menu item for HV parameters
    handles.figGUI_menuHV_menuStatus = uimenu(...
        'Parent', handles.figGUI_menuHV, ...
        'Label', 'Settings', ...
        'Callback', {@BuildFigureWindows, 'HV status'}...
        );
    
    
    % Menu item for HV disconnect
    handles.figGUI_menuHV_menuDiscon = uimenu(...
        'Parent', handles.figGUI_menuHV, ...
        'Label', 'Disconnect', ...
        'Enable', 'Off', ...
        'Callback', {@CallbackFunc_Pressbutton, {'HV', 'disconnect HV'}, []}...
        );

    
    % Menu item for HV COM settings
    handles.figGUI_menuHV_menuCOM = uimenu(...
        'Parent', handles.figGUI_menuHV, ...
        'Label', 'COM Settings', ...
        'Separator', 'on', ...
        'Callback', {@BuildFigureWindows, 'hv com'}...
        );

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 
    % Menu item for chiller settings
    handles.figGUI_menuChiller = uimenu(...
        'Parent', handles.figGUI, ...
        'Label', 'Chiller'...
        );

    % Menu item for chiller status
    handles.figGUI_menuChiller_menuConnect = uimenu(...
        'Parent', handles.figGUI_menuChiller, ...
        'Label', 'Connect', ...
        'Callback', {@CallbackFunc_Pressbutton, {'Chiller', 'connect chiller'}, []}...
        );

    % Menu item for chiller status
    handles.figGUI_menuChiller_menuStatus = uimenu(...
        'Parent', handles.figGUI_menuChiller, ...
        'Label', 'Status', ...
        'Enable', 'Off', ...
        'Callback', {@BuildFigureWindows, 'chiller status'}...
        );
    
    % Menu item for chiller control
    handles.figGUI_menuChiller_menuControl = uimenu(...
        'Parent', handles.figGUI_menuChiller, ...
        'Label', 'Control', ...
        'Enable', 'Off', ...
        'Callback', {@BuildFigureWindows, 'chiller control'}...
        );
    
    % Menu item for chiller status
    handles.figGUI_menuChiller_menuDisconnect = uimenu(...
        'Parent', handles.figGUI_menuChiller, ...
        'Label', 'Disconnect', ...
        'Enable', 'Off', ...
        'Callback', {@CallbackFunc_Pressbutton, {'Chiller', 'disconnect chiller'}, []}...
        );

    % Menu item for chiller COM settings
    handles.figGUI_menuChiller_menuCOM = uimenu(...
        'Parent', handles.figGUI_menuChiller, ...
        'Label', 'COM Settings', ...
        'Separator', 'on', ...
        'Callback', {@BuildFigureWindows, 'chiller com'}...
        );

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


    % Menu item for shutters settings
    handles.figGUI_menuShutters = uimenu(...
        'Parent', handles.figGUI, ...
        'Label', 'Shutters'...
        );

    % Menu item for setting to trigger control
    handles.figGUI_menuShutters_menuTrigger = uimenu(...
        'Parent', handles.figGUI_menuShutters, ...
        'Label', 'Trigger control...'...
        );

    % Menu item for setting to reset control
    handles.figGUI_menuShutters_menuReset = uimenu(...
        'Parent', handles.figGUI_menuShutters, ...
        'Label', 'Reset control...'...
        );

    % Submenu item for list of shutters
    for(i = 1:3)

        handles.figGUI_menuShutters_menuTrigger_shutterList(i) = uimenu(...
            'Parent', handles.figGUI_menuShutters_menuTrigger, ...
            'Label', sprintf('Shutter %d', i), ...
            'Callback', {@CallbackFunc_Pressbutton, {'Shutters', 'trigger control'}, sprintf('Shutter %d', i)}...
            );
                
        handles.figGUI_menuShutters_menuReset_shutterList(i) = uimenu(...
            'Parent', handles.figGUI_menuShutters_menuReset, ...
            'Label', sprintf('Shutter %d', i), ...
            'Callback', {@CallbackFunc_Pressbutton, {'Shutters', 'reset control'}, sprintf('Shutter %d', i)}...
            );
    end

    % Menu item for shutters COM settings
    handles.figGUI_menuShutters_menuCOM = uimenu(...
        'Parent', handles.figGUI_menuShutters, ...
        'Label', 'COM Settings', ...
        'Separator', 'on', ...
        'Callback', {@BuildFigureWindows, 'shutters com'}...
        );

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	% Menu item for camera settings
    handles.figGUI_menuCamera = uimenu(...
    	'Parent', handles.figGUI, ...
    	'Label', 'Camera'...
    	);

    % Submenu item for camera status
    handles.figGUI_menuCamera_menuStatus = uimenu(...
    	'Parent', handles.figGUI_menuCamera, ...
    	'Label', 'Status', ...
    	'Callback', {@BuildFigureWindows, 'camera status'}...
    	);

    % Submenu item for camera image settings
    handles.figGUI_menuCamera_menuImgSettings = uimenu(...
        'Parent', handles.figGUI_menuCamera, ...
        'Label', 'Image Settings', ...
        'Callback', {@BuildFigureWindows, 'camera image settings'}...
        );

    % Submenu item for camera configuration
    handles.figGUI_menuCamera_menuConfig = uimenu(...
    	'Parent', handles.figGUI_menuCamera, ...
    	'Label', 'Configuration', ...
    	'Callback', {@BuildFigureWindows, 'camera config'}...
    	);

% Submenu item for electron optimization
    handles.figGUI_menuCamera_electronint = uimenu(...
    	'Parent', handles.figGUI_menuCamera, ...
    	'Label', 'Electron optimization', ...
    	'Callback', {@BuildFigureWindows, 'Electron integration'}...
    	);

    
    % Submenu item for camera COM settings
    handles.figGUI_menuCamera_menuCOM = uimenu(...
        'Parent', handles.figGUI_menuCamera, ...
        'Label', 'COM Settings', ...
        'Separator', 'on', ...
        'Callback', {@BuildFigureWindows, 'camera com'}...
        );

	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    % Menu item for stage settings
    handles.figGUI_menuStages = uimenu(...
        'Parent', handles.figGUI, ...
        'Label', 'Stages'...
        );

    % Submenu item for stage reset command
    handles.figGUI_menuStages_menuReset = uimenu(...
        'Parent', handles.figGUI_menuStages, ...
        'Label', 'Reset...'...
        );

    % Submenu item for stage home command
    handles.figGUI_menuStages_menuHome = uimenu(...
        'Parent', handles.figGUI_menuStages, ...
        'Label', 'Home...'...
        );

    % Submenu item for stage configuration parameters
    handles.figGUI_menuStages_menuConfig = uimenu(...
        'Parent', handles.figGUI_menuStages, ...
        'Label', 'Configuration'...
        );

    % Submenu item for list of stages
    for(i = 1:5)

        handles.figGUI_menuStages_menuReset_stageList(i) = uimenu(...
            'Parent', handles.figGUI_menuStages_menuReset, ...
            'Label', handles.stages_name{i}, ...
            'Callback', {@CallbackFunc_Pressbutton,{'Stages', 'reset'}, handles.stages_name{i}}...
            );


        handles.figGUI_menuStages_menuHome_stageList(i) = uimenu(...
            'Parent', handles.figGUI_menuStages_menuHome, ...
            'Label', handles.stages_name{i}, ...
            'Callback', {@CallbackFunc_Pressbutton,{'Stages', 'home'}, handles.stages_name{i}}...
            );


        handles.figGUI_menuStages_menuConfig_stageList(i) = uimenu(...
            'Parent', handles.figGUI_menuStages_menuConfig, ...
            'Label', handles.stages_name{i}, ...
            'Callback', {@BuildFigureWindows, sprintf('stages config %d', i)}...
            );

    end

    % Submenu item stage COM settings
    handles.figGUI_menuStages_menuCOM = uimenu(...
        'Parent', handles.figGUI_menuStages, ...
        'Label', 'COM Settings', ...
        'Separator', 'on', ...
        'Callback', {@BuildFigureWindows, 'stages com'}...
        );

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    
    % Menu item for timer
    handles.figGUI_menuTimer = uimenu(...
        'Parent', handles.figGUI, ...
        'Label', 'Timer' ...
        );

        % Submenu item for timer control
    handles.figGUI_menuTools_menuTimer = uimenu(...
        'Parent', handles.figGUI_menuTimer, ...
        'Label', 'Control timer...'...
        );

    % Submenu item to start timer
    handles.figGUI_menuTools_menuTimer_menuStart = uimenu(...
        'Parent', handles.figGUI_menuTools_menuTimer, ...
        'Label', 'Start', ...
        'Callback', {@ControlTimer, 'start'}...
        );

    % Submenu item to stop timer
    handles.figGUI_menuTools_menuTimer_menuStop = uimenu(...
        'Parent', handles.figGUI_menuTools_menuTimer, ...
        'Label', 'Stop', ...
        'Callback', {@ControlTimer, 'stop'}...
        );
    
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    

    % Initialize menu items
    for(i = 1:3)
        set(handles.figGUI_menuShutters_menuTrigger_shutterList(i), 'Enable', 'off');
        set(handles.figGUI_menuShutters_menuReset_shutterList(i), 'Enable', 'off');
    end

    set(handles.figGUI_menuCamera_menuStatus, 'Enable', 'off');
    set(handles.figGUI_menuCamera_menuImgSettings, 'Enable', 'off');
    set(handles.figGUI_menuCamera_menuConfig, 'Enable', 'off');
    set(handles.figGUI_menuCamera_electronint, 'Enable', 'off');
    set(handles.figGUI_menuCamera_menuCOM, 'Enable', 'on');
    
    set(handles.figGUI_menuHV_menuStatus,'Enable', 'off');

    for(i = 1:5)
        set(handles.figGUI_menuStages_menuReset_stageList(i), 'Enable' ,'off');
        set(handles.figGUI_menuStages_menuHome_stageList(i), 'Enable' ,'off');
        set(handles.figGUI_menuStages_menuConfig_stageList(i), 'Enable' ,'off');
    end
    
    % Disable timer menu
    set(handles.figGUI_menuTools_menuTimer, 'Enable', 'off');
    set(handles.figGUI_menuTimer, 'Enable', 'off');

    % Save handles in base workspace
    assignin('base','handles',handles)
    
end

